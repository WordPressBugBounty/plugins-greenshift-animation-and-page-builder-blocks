const GS_SESSION_ID="uid-"+Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,11);function GSrunAPICall(e){if("string"==typeof e&&(e=JSON.parse(e)),!e)return;function r(e,r){if(!r)return e;let t=r.match(/(\w+)|\[(\d+)\]/g);if(t)return t.reduce((e,r)=>(r=r.replace(/[\[\]]/g,""),e?e[r]:void 0),e)}let t=[{regex:/\{\{TEXT:(.*?)\}\}/g,handler(e){let r=document.querySelector(e);return r&&r.innerText?r.innerText:""}},{regex:/\{\{VALUE:(.*?)\}\}/g,handler(e){let r=document.querySelector(e);return r&&r.value?r.value:""}},{regex:/\{\{COOKIE:(.*?)\}\}/g,handler(e){let r;return GSCookClass.getCookie(e)||""}},{regex:/\{\{STORAGE:(.*?)\}\}/g,handler(e){let r;return localStorage.getItem(e)||""}},{regex:/\{\{ATTR:(.*?)\}\}/g,handler(e){let r=e.split("|").map(e=>e.trim());if(2===r.length){let t=r[0],l=document.querySelector(r[1]);return l&&l.getAttribute(t)||""}return""}},{regex:/\{\{FORMDATA:(.*?)\}\}/g,handler(e){let r=document.querySelector(e);if(r){let t=new FormData(r),l={};return t.forEach((e,r)=>{l[r]=e}),JSON.stringify(l)}return""}},{regex:/\{\{SESSION_ID\}\}/g,handler:()=>GS_SESSION_ID}],l=e=>{if("string"!=typeof e)return e;let r=e;for(let{regex:l,handler:a}of t)r=r.replace(l,(e,r)=>a(r));return r},{result_selector:a,result_handle:n="replace",loader_selector:i,apiHeaders:c,apiUrl:o,apiMethod:s,apiBody:u,responseField:g,appendField:p,systemField:d,user_message:h,custom_response:f,responseMaps:m,response_selector:L,repeatable:S,stream_chat:E=!1,no_data_text:v="No data found"}=e,A=Array.isArray(c)?c.reduce((e,r)=>(r.name&&(e[r.name]=l(r.value)),e),{}):{},_=i?document.querySelector(i):null;_&&_.classList.add("active");let b=a?document.querySelector(a):null;b&&(b.classList.remove("loaded"),b.classList.remove("active"),b.classList.add("loading"));let y="gspb-api-saved-var";g&&(y=g.replace(/[^a-zA-Z0-9]/g,""));let $=(e,t,l)=>{if(t&&e){let a=JSON.parse(e),n=r(a,t);n&&(Array.isArray(n)?n.push(l):a[t]=l),e=JSON.stringify(a)}return e},O=u?l(u):null;E&&void 0!==window[y]&&(O=window[y]);let q=h?l(h):null;q&&(O=$(O,p,JSON.parse(l(q)))),fetch(l(o),{method:s||"GET",headers:A,body:O}).then(e=>e.json()).then(e=>{let t=g?r(e,g):e,l=t;if(d&&t&&O&&p){let a=r(t,d);a&&(O=$(O,p,a)),window[y]=O}else window[y]=l;if(void 0===l&&(l='<div class="gspb-api-noresponse">'+v+"</div>"),f&&m&&L){let i=document.querySelector(L),c="",o=[];if(i){let s=e=>{let t=i.cloneNode(!0);return m.forEach(l=>{let a=l.name,n=r(e,l.value);void 0===n&&o.push(l.name);let i=t.querySelector(a);if(i&&void 0!==n){if("date"===l.format&&(n=new Date(n).toLocaleString()),"markdown"===l.format&&"string"==typeof n){let c=[],s=[];n=(n=(n=(n=(n=(n=(n=(n=n.replace(/```([\s\S]*?)```/gim,function(e,r){let t=r,l="",a=t.match(/^([a-zA-Z0-9_+-]+)\s*\n/);return a&&(l=a[1].toLowerCase(),t=t.substring(a[0].length)),c.push({content:t,language:l}),"CODE_BLOCK_PLACEHOLDER_"+(c.length-1)})).replace(/`(.*?)`/gim,function(e,r){return s.push(r),"INLINE_CODE_PLACEHOLDER_"+(s.length-1)})).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")).replace(/^### (.*$)/gim,"<h3>$1</h3>")).replace(/^## (.*$)/gim,"<h2>$1</h2>")).replace(/^# (.*$)/gim,"<h1>$1</h1>")).replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>")).replace(/\*(.*?)\*/gim,"<em>$1</em>");let u=!1,g="",p=n.split("\n");for(let d=0;d<p.length;d++){let h=p[d].match(/^\s*[\*\-] (.*)/),f=p[d].match(/^\s*(\d+)\. (.*)/);h?u&&"ul"===g?p[d]="<li>"+h[1]+"</li>":(u?p[d]="</"+g+"><ul><li>"+h[1]+"</li>":p[d]="<ul><li>"+h[1]+"</li>",u=!0,g="ul"):f?u&&"ul"===g?p[d]="<li>"+f[2]+"</li>":(u?p[d]="</"+g+"><ul><li>"+f[2]+"</li>":p[d]="<ul><li>"+f[2]+"</li>",u=!0,g="ul"):u&&""===p[d].trim()?(p[d]="</"+g+">",u=!1):u&&""!==p[d].trim()&&(p[d-1]=p[d-1].replace(/<\/li>$/," "+p[d]+"</li>"),p[d]="")}u&&p.push("</"+g+">"),n=(n=(n=(n=(n=(n=(n=(n=(n=(n=p.join("\n")).replace(/\[(.*?)\]\((.*?)\)/gim,'<a href="$2">$1</a>')).replace(/^(?!\s*<\/?(?:ul|ol|li|h\d|blockquote|pre|img|code))[^\n<]+(?:\n(?!\s*<\/?(?:ul|ol|li|h\d|blockquote|pre|img|code))[^\n<]+)*/gim,function(e){return""===e.trim()?"":"<p>"+e+"</p>"})).replace(/\n(?!\s*<\/?(?:p|ul|ol|li|h\d|blockquote|pre|code))/gim,"<br>")).replace(/<p>\s*<\/p>/gim,"")).replace(/CODE_BLOCK_PLACEHOLDER_(\d+)/g,function(e,r){let t=c[parseInt(r)],l=t.content,a=t.language;return(l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a)?'<div class="code_language">'+a+"</div><pre><code>"+l+"</code></pre>":"<pre><code>"+l+"</code></pre>"})).replace(/INLINE_CODE_PLACEHOLDER_(\d+)/g,function(e,r){let t=s[parseInt(r)];return"<code>"+(t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"))+"</code>"})).replace(/(<br>\s*)+/g,"<br>")).replace(/^\s*<br>/g,"")).replace(/<br>\s*$/g,"")}i.hasAttribute("src")?i.setAttribute("src",n):i.hasAttribute("href")?i.setAttribute("href",n):i.innerHTML=n}}),t.innerHTML};S&&Array.isArray(l)?l.forEach(e=>{c+=s(e)}):c=s(l),c&&(l=c),o.length>0&&o.length===m.length&&(l='<div class="gspb-api-noresponse">'+v+"</div>")}}if(b){"replace"===n?b.innerHTML=l:"append"===n?b.innerHTML+=l:"prepend"===n&&(b.innerHTML=l+b.innerHTML),Array.from(b.children).forEach(e=>{e.classList.contains("result-loaded")||setTimeout(()=>{e.classList.add("result-loaded")},10)});let u=b.querySelectorAll("[data-gspbactions]");u.length>0&&"function"==typeof GSPB_Trigger_Actions&&GSPB_Trigger_Actions("front",u),"undefined"!=typeof GSChartRun&&GSChartRun(b),document.dispatchEvent(new CustomEvent("GSPB_API_RESPONSE",{detail:{resultElem:b,responseData:t}}))}}).catch(e=>{console.error("Fetch error:",e)}).finally(()=>{if(_&&_.classList.remove("active"),b){b.classList.remove("loading"),setTimeout(()=>{b.classList.add("loaded"),b.classList.add("active")},50);let e=b.getAttribute("data-nextrun");if(e){let r=parseInt(e);b.setAttribute("data-nextrun",r+1)}else b.setAttribute("data-nextrun",2)}b&&b.querySelector(".gspb-api-noresponse")&&setTimeout(()=>{b.querySelector(".gspb-api-noresponse").remove()},1e3)})}