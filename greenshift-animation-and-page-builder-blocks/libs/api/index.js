const GS_SESSION_ID="uid-"+Date.now().toString(36)+"-"+Math.random().toString(36).slice(2,11);function GSrunAPICall(e){if("string"==typeof e&&(e=JSON.parse(e)),!e)return;function t(e,t){if(!t)return e;let r=t.match(/(\w+)|\[(\d+)\]/g);if(r)return r.reduce((e,t)=>(t=t.replace(/[\[\]]/g,""),e?e[t]:void 0),e)}let r=[{regex:/\{\{TEXT:(.*?)\}\}/g,handler(e){let t=document.querySelector(e);return t&&t.innerText?t.innerText:""}},{regex:/\{\{VALUE:(.*?)\}\}/g,handler(e){let t=document.querySelector(e);return t&&t.value?t.value:""}},{regex:/\{\{COOKIE:(.*?)\}\}/g,handler(e){let t;return GSCookClass.getCookie(e)||""}},{regex:/\{\{STORAGE:(.*?)\}\}/g,handler(e){let t;return localStorage.getItem(e)||""}},{regex:/\{\{ATTR:(.*?)\}\}/g,handler(e){let t=e.split("|").map(e=>e.trim());if(2===t.length){let r=t[0],n=document.querySelector(t[1]);return n&&n.getAttribute(r)||""}return""}},{regex:/\{\{FORMDATA:(.*?)\}\}/g,handler(e){let t=document.querySelector(e);if(t){let r=new FormData(t),n={};return r.forEach((e,t)=>{n[t]=e}),JSON.stringify(n)}return""}},{regex:/\{\{SESSION_ID\}\}/g,handler:()=>GS_SESSION_ID}],n=e=>{if("string"!=typeof e)return e;let t=e;for(let{regex:n,handler:l}of r)t=t.replace(n,(e,t)=>l(t));return t},{result_selector:l,result_handle:a="replace",loader_selector:i,apiHeaders:s,apiUrl:o,apiMethod:d,apiBody:c,responseField:u,custom_response:g,responseMaps:f,response_selector:h,repeatable:S,no_data_text:p="No data found"}=e,v=Array.isArray(s)?s.reduce((e,t)=>(t.name&&(e[t.name]=n(t.value)),e),{}):{},y=i?document.querySelector(i):null;y&&y.classList.add("active");let A=l?document.querySelector(l):null;A&&(A.classList.remove("loaded"),A.classList.remove("active"),A.classList.add("loading")),fetch(n(o),{method:d||"GET",headers:v,body:c?n(c):null}).then(e=>e.json()).then(e=>{let r=u?t(e,u):e,n=r;if(void 0===n&&(n='<div class="gspb-api-noresponse">'+p+"</div>"),g&&f&&h){let l=document.querySelector(h),i="",s=[];if(l){let o=e=>{let r=l.cloneNode(!0);return f.forEach(n=>{let l=n.name,a=t(e,n.value);void 0===a&&s.push(n.name);let i=r.querySelector(l);i&&void 0!==a&&("date"===n.format&&(a=new Date(a).toLocaleString()),i.hasAttribute("src")?i.setAttribute("src",a):i.hasAttribute("href")?i.setAttribute("href",a):i.innerHTML=a)}),r.innerHTML};S&&Array.isArray(n)?n.forEach(e=>{i+=o(e)}):i=o(n),i&&(n=i),s.length>0&&s.length===f.length&&(n='<div class="gspb-api-noresponse">'+p+"</div>")}}if(A){"replace"===a?A.innerHTML=n:"append"===a?A.innerHTML+=n:"prepend"===a&&(A.innerHTML=n+A.innerHTML),Array.from(A.children).forEach(e=>{e.classList.contains("result-loaded")||setTimeout(()=>{e.classList.add("result-loaded")},10)});let d=A.querySelectorAll("[data-gspbactions]");d.length>0&&"function"==typeof GSPB_Trigger_Actions&&GSPB_Trigger_Actions("front",d),document.dispatchEvent(new CustomEvent("GSPB_API_RESPONSE",{detail:{resultElem:A,responseData:r}}))}}).catch(e=>{console.error("Fetch error:",e)}).finally(()=>{if(y&&y.classList.remove("active"),A){A.classList.remove("loading"),setTimeout(()=>{A.classList.add("loaded"),A.classList.add("active")},50);let e=A.getAttribute("data-nextrun");if(e){let t=parseInt(e);A.setAttribute("data-nextrun",t+1)}else A.setAttribute("data-nextrun",2)}A&&A.querySelector(".gspb-api-noresponse")&&setTimeout(()=>{A.querySelector(".gspb-api-noresponse").remove()},1e3)})}